/*
 * snapScroll 0.1.0
 * 
 *
 * http://www.ghugo.com
 *
 * Copyright 2014, hugohua
 *
 * Licensed under MIT
 *
 * Released on: May 17, 2014
*/
!function(a){a.fn.anim=function(a,b,c){var d,e,f=[];for(e in a)"opacity"===e?d=a[e]:f.push(e+"("+a[e]+")");return this.css({"-webkit-transition":"all "+(b||.5)+"s "+(c||""),"-webkit-transform":f.join(" "),opacity:d})}}(Zepto),function(a,b){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a){b.setTimeout(a,1e3/60)},d="ontouchstart"in b,e="onorientationchange"in b?"orientationchange":"resize",f=d?"touchstart":"mousedown",g=d?"touchmove":"mousemove",h=d?"touchend":"mouseup",i=d?"touchcancel":"mouseup",j=function(){function j(b,c){this.$el=a(b),this.options=a.extend({},a.fn.snapscroll.defaults,c),this.init()}return j.prototype={constructor:j,name:"scroll",version:"0.0.2",init:function(){this.$pages=this.$el.children(),this.length=this.$pages.length-1,this.width=this.$el.width(),this.height=this.$el.height(),this.curIndex=0,this.newIndex=0,this.startTime=null,this.drag=null,this.startY=null,this.direction=null,this.directionLocked=null,this.$target=null,this._initEvent(),console.log("init")},_initEvent:function(){this.$el.on(f,a.proxy(this.handleEvent,this)).on(g,a.proxy(this.handleEvent,this)).on(h,a.proxy(this.handleEvent,this)).on(i,a.proxy(this.handleEvent,this)),this.$pages.on("webkitTransitionEnd",a.proxy(this.handleEvent,this)),b.addEventListener(e,this,!1)},handleEvent:function(a){switch(a.type){case"tap":this._start(a);break;case f:this._start(a);break;case g:this._move(a);break;case h:case i:this._end(a);break;case"webkitTransitionEnd":this._flip(a);break;case e:this._resize()}},_start:function(a){if(!this.moved){var b=d?a.touches[0]:a;this.startTime=Date.now(),this.drag=!0,this.startX=b.pageX,this.startY=b.pageY}},_move:function(a){if(a.preventDefault(),a.stopPropagation(),!this.moved&&this.drag){var b,c,e,f=d?a.touches[0]:a,g=f.pageX-this.startX,h=f.pageY-this.startY;this.absDistX=Math.abs(g),this.absDistY=Math.abs(h),this.absDistX<10&&this.absDistY<10||(this.directionLocked||(e=this.absDistX-this.absDistY-this.options.directionLockThreshold>0,"n"===this.options.scroll&&e||"h"===this.options.scroll?(this.directionLocked="h",this.direction=g>0?"LEFT":"RIGHT"):(this.directionLocked="v",this.direction=h>0?"DOWN":"UP"),this.newIndex="LEFT"===this.direction||"DOWN"===this.direction?this.curIndex-1:this.curIndex+1,this.options.loop&&(this.newIndex<0&&(this.newIndex=this.length),this.newIndex>this.length&&(this.newIndex=0)),this.$target=this.$pages.eq(this.newIndex),this.$el.trigger("start:"+this.name,[this.curIndex,this.newIndex,this.direction])),this.$target&&("UP"===this.direction?(b=0,c=this.height+h):"DOWN"===this.direction?(b=0,c=h-this.height):"LEFT"===this.direction?(b=g-this.width,c=0):"RIGHT"===this.direction&&(b=this.width+g,c=0),this.x=b,this.y=c,this._translate(b,c)))}},_end:function(){var a,b,c=0,d=0;this.drag=null,this.$target&&(this.moved=!0,this.change=!0,a=this.height/this.absDistY>this.options.scrollThreshold,b=this.width/this.absDistX>this.options.scrollThreshold,"UP"===this.direction&&a?(c=0,d=this.height,this.change=null):"DOWN"===this.direction&&a?(c=0,d=-this.height,this.change=null):"LEFT"===this.direction&&b?(c=-this.width,d=0,this.change=null):"RIGHT"===this.direction&&b&&(c=this.width,d=0,this.change=null),this._scrollTo(c,d))},_flip:function(){this.moved&&(this._offTranslate(),this.directionLocked=null,this.moved=null,this.change&&(this.$pages.eq(this.curIndex).removeClass("show"),this.$target.addClass("show"),this.curIndex=this.newIndex),this.$target.removeClass("active").removeAttr("style"),this.$target=null,this.change=null,this.$el.trigger("done:"+this.name,[this.newIndex,this.direction]))},_resize:function(){this.width=this.$el.width(),this.height=this.$el.height()},_translate:function(a,b){var d=this;c(function(){d.$target&&d.$target.addClass("active").css({"-webkit-transform":"translate3d("+a+"px,"+b+"px,0)"})})},_scrollTo:function(a,b,c){c=c||this.options.speed,this.isInTransition=this.options.useTransition&&c>0,this.options.useTransition?(this.$target.css("-webkit-transition","-webkit-transform "+c+"ms"),this._translate(a,b),console.info(this.newIndex)):this._animate(a,b,c)},_animate:function(a,b,d){function e(){return"v"==f.directionLocked&&g>0?(f.y+=h,f.y>b&&(f.y=b),f._translate(0,f.y)):"v"==f.directionLocked&&0>g?(f.y+=h,f.y<b&&(f.y=b),f._translate(0,f.y)):"h"==f.directionLocked&&g>0?(f.x+=h,f.x>a&&(f.x=a),f._translate(f.x,0)):"h"==f.directionLocked&&0>g&&(f.x+=h,f.x<a&&(f.x=a),f._translate(f.x,0)),"v"==f.directionLocked&&f.y===b||"h"==f.directionLocked&&f.x===a?void f._flip():void(("v"==f.directionLocked&&g>0&&f.y<b||"v"==f.directionLocked&&0>g&&f.y>b||"h"==f.directionLocked&&0>g&&f.x>a||"h"==f.directionLocked&&g>0&&f.x<a)&&c(e))}var f=this,g="v"==f.directionLocked?b-f.y:a-f.x,h=g/d*16;0!==g&&e()},_offTranslate:function(){this.$target.css("-webkit-transition","-webkit-transform 0ms")},goTo:function(a,b){this.curIndex==a||this.isAnimating||(this.newIndex=a,this.$target=this.$pages.eq(this.newIndex),"n"===this.options.scroll&&"v"===b)}},j}();a.fn.snapscroll=function(b){return this.each(function(){var c=a(this),d=a.fn.snapscroll.lookup[c.data("snapscroll")];return d||(a.fn.snapscroll.lookup[++a.fn.snapscroll.lookup.i]=new j(this,b),c.data("snapscroll",a.fn.snapscroll.lookup.i),d=a.fn.snapscroll.lookup[c.data("snapscroll")]),"string"==typeof b?d[b].apply(d,[].slice.call(arguments,1)):void 0})},a.fn.snapscroll.lookup={i:0},a.fn.snapscroll.defaults={directionLockThreshold:5,scroll:"n",scrollThreshold:4,speed:400,loop:!0,useTransition:!0}}(Zepto,window);